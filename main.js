var S=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var V=(r,s)=>{for(var e in s)S(r,e,{get:s[e],enumerable:!0})},C=(r,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of R(s))!O.call(r,i)&&i!==e&&S(r,i,{get:()=>s[i],enumerable:!(t=k(s,i))||t.enumerable});return r};var A=r=>C(S({},"__esModule",{value:!0}),r);var I={};V(I,{default:()=>y});module.exports=A(I);var b=require("obsidian");var h="repo-nav-tree-view",E={showHiddenDirs:!0,fileExtensions:".md",excludedDirs:"node_modules,.git",sortOrder:"folders-first",collapseOnStartup:!1},m="folder-tree";var f=require("obsidian"),w=class extends f.PluginSettingTab{constructor(s,e){super(s,e),this.plugin=e}display(){let{containerEl:s}=this;s.empty(),new f.Setting(s).setName("Show hidden directories").setDesc("Include dot-prefixed directories (e.g., .github, .obsidian) in the tree. Hidden folders are shown by default.").addToggle(e=>e.setValue(this.plugin.settings.showHiddenDirs).onChange(async t=>{this.plugin.settings.showHiddenDirs=t,await this.plugin.saveSettings()})),new f.Setting(s).setName("File extensions").setDesc("Comma-separated list of extensions to include (e.g., .md,.mdx).").addText(e=>e.setPlaceholder(".md").setValue(this.plugin.settings.fileExtensions).onChange(async t=>{this.plugin.settings.fileExtensions=t,await this.plugin.saveSettings()})),new f.Setting(s).setName("Excluded directories").setDesc("Comma-separated directory names to always exclude.").addText(e=>e.setPlaceholder("node_modules,.git").setValue(this.plugin.settings.excludedDirs).onChange(async t=>{this.plugin.settings.excludedDirs=t,await this.plugin.saveSettings()})),new f.Setting(s).setName("Sort order").setDesc("How to sort files and directories in the tree.").addDropdown(e=>e.addOption("folders-first","Folders first").addOption("az","Alphabetical (A-Z)").addOption("za","Alphabetical (Z-A)").setValue(this.plugin.settings.sortOrder).onChange(async t=>{this.plugin.settings.sortOrder=t,await this.plugin.saveSettings()})),new f.Setting(s).setName("Collapse on startup").setDesc("Start with all directories collapsed when opening the view.").addToggle(e=>e.setValue(this.plugin.settings.collapseOnStartup).onChange(async t=>{this.plugin.settings.collapseOnStartup=t,await this.plugin.saveSettings()}))}};var p=require("obsidian");function L(r){return r.trim()?r.split(",").map(s=>s.trim()).filter(s=>s.length>0).map(s=>s.startsWith(".")?s:"."+s):[]}function F(r){return r.trim()?new Set(r.split(",").map(s=>s.trim()).filter(s=>s.length>0)):new Set}function P(r,s){if(r.type!=="file"){for(let e of r.children)P(e,s);switch(s){case"folders-first":r.children.sort((e,t)=>e.type!==t.type?e.type==="directory"?-1:1:e.name.localeCompare(t.name));break;case"az":r.children.sort((e,t)=>e.name.localeCompare(t.name));break;case"za":r.children.sort((e,t)=>t.name.localeCompare(e.name));break}}}function D(r,s){let e=L(s.fileExtensions),t=F(s.excludedDirs),i={name:"/",path:"",type:"directory",children:[]};if(e.length===0)return i;let a=new Map;a.set("",i);let c=r.vault.getFiles().filter(n=>e.some(o=>n.path.endsWith(o)));for(let n of c){let o=n.path.split("/"),v=o.pop(),d="",N=!1;for(let g of o){let T=d;if(d=d?d+"/"+g:g,t.has(g)){N=!0;break}if(!s.showHiddenDirs&&g.startsWith(".")){N=!0;break}if(!a.has(d)){let x={name:g,path:d,type:"directory",children:[]};a.set(d,x),a.get(T).children.push(x)}}if(!N){let T={name:v.replace(/\.[^.]+$/,""),path:n.path,type:"file",children:[]};a.get(d).children.push(T)}}return P(i,s.sortOrder),i}var u=class extends p.ItemView{constructor(e,t){super(e);this.treeData=null;this.expandedPaths=new Set;this.debounceTimer=null;this.plugin=t}getViewType(){return h}getDisplayText(){return"Repository Navigator"}getIcon(){return m}async onOpen(){if(this.expandedPaths=new Set,this.treeData=D(this.app,this.plugin.settings),!this.plugin.settings.collapseOnStartup&&this.treeData)for(let e of this.treeData.children)e.type==="directory"&&this.expandedPaths.add(e.path);this.renderView(),this.registerEvent(this.app.vault.on("create",()=>this.debouncedRefresh())),this.registerEvent(this.app.vault.on("delete",()=>this.debouncedRefresh())),this.registerEvent(this.app.vault.on("rename",()=>this.debouncedRefresh())),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>this.updateActiveFile()))}async onClose(){this.debounceTimer!==null&&clearTimeout(this.debounceTimer)}renderView(){this.contentEl.empty();let e=this.contentEl.createDiv({cls:"repo-nav-header"}),t=this.collectAllDirPaths(this.treeData),i=t.size>0&&t.size===this.expandedPaths.size,a=e.createEl("button",{attr:{"aria-label":i?"Collapse all":"Expand all"}});(0,p.setIcon)(a,i?"chevrons-down-up":"chevrons-up-down"),a.addEventListener("click",()=>{if(i)this.expandedPaths.clear();else for(let n of t)this.expandedPaths.add(n);this.renderView()});let l=e.createEl("button",{attr:{"aria-label":"Refresh"}});(0,p.setIcon)(l,"refresh-cw"),l.addEventListener("click",()=>{this.refreshTree()});let c=this.contentEl.createDiv({cls:"repo-nav-tree"});if(!this.treeData||this.treeData.children.length===0){c.createDiv({cls:"repo-nav-empty",text:"No Markdown files found in this vault."});return}for(let n of this.treeData.children)this.renderNode(c,n,0)}renderNode(e,t,i){let a=e.createDiv({cls:"repo-nav-node"});if(a.style.paddingLeft=`${i*16}px`,a.dataset.path=t.path,t.type==="directory"){a.addClass("repo-nav-dir");let l=this.expandedPaths.has(t.path),c=a.createSpan({cls:"repo-nav-chevron"});(0,p.setIcon)(c,l?"chevron-down":"chevron-right");let n=a.createSpan({cls:"repo-nav-icon"});if((0,p.setIcon)(n,"folder"),a.createSpan({cls:"repo-nav-name",text:t.name}),a.addEventListener("click",o=>{o.stopPropagation(),this.expandedPaths.has(t.path)?this.expandedPaths.delete(t.path):this.expandedPaths.add(t.path),this.renderView()}),l){let o=e.createDiv({cls:"repo-nav-children"});for(let v of t.children)this.renderNode(o,v,i+1)}}else{a.addClass("repo-nav-file");let l=this.app.workspace.getActiveFile();l&&l.path===t.path&&a.addClass("repo-nav-active");let c=a.createSpan({cls:"repo-nav-icon"});(0,p.setIcon)(c,"file-text"),a.createSpan({cls:"repo-nav-name",text:t.name}),a.addEventListener("click",async n=>{n.stopPropagation();let o=this.app.vault.getAbstractFileByPath(t.path);o instanceof p.TFile&&(n.metaKey||n.ctrlKey?await this.app.workspace.getLeaf("tab").openFile(o):await this.app.workspace.getLeaf(!1).openFile(o))})}}collectAllDirPaths(e){let t=new Set;if(!e)return t;let i=a=>{a.type==="directory"&&a.path&&t.add(a.path);for(let l of a.children)i(l)};return i(e),t}debouncedRefresh(){this.debounceTimer!==null&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.refreshTree()},300)}updateActiveFile(){let e=this.app.workspace.getActiveFile();if(this.containerEl.querySelectorAll(".repo-nav-file").forEach(i=>i.removeClass("repo-nav-active")),e){let i=this.containerEl.querySelector(`.repo-nav-file[data-path="${CSS.escape(e.path)}"]`);i&&i.addClass("repo-nav-active")}}refreshTree(){this.treeData=D(this.app,this.plugin.settings),this.renderView()}};var y=class extends b.Plugin{constructor(){super(...arguments);this.settings=E}async onload(){await this.loadSettings(),this.registerView(h,e=>new u(e,this)),this.addRibbonIcon(m,"Repository Navigator",()=>{this.activateView()}),this.addCommand({id:"open-repo-nav",name:"Open tree view",callback:()=>{this.activateView()}}),this.addSettingTab(new w(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.activateView()})}onunload(){this.app.workspace.detachLeavesOfType(h)}async activateView(){let e=this.app.workspace.getLeavesOfType(h);if(e.length>0){this.app.workspace.revealLeaf(e[0]);return}let t=this.app.workspace.getLeftLeaf(!1);t&&(await t.setViewState({type:h,active:!0}),this.app.workspace.revealLeaf(t))}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},E,e),this.settings.showHiddenDirs===!1&&(this.settings.showHiddenDirs=!0,await this.saveData(this.settings))}async saveSettings(){await this.saveData(this.settings);let e=this.app.workspace.getLeavesOfType(h);for(let t of e){let i=t.view;i instanceof u&&i.refreshTree()}}};
