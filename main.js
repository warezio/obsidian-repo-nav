var T=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var R=(a,i)=>{for(var e in i)T(a,e,{get:i[e],enumerable:!0})},V=(a,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of A(i))!L.call(a,s)&&s!==e&&T(a,s,{get:()=>i[s],enumerable:!(t=C(i,s))||t.enumerable});return a};var O=a=>V(T({},"__esModule",{value:!0}),a);var _={};R(_,{default:()=>y});module.exports=O(_);var k=require("obsidian");var u="repo-nav-tree-view",D={showHiddenDirs:!0,fileExtensions:".md",excludedDirs:"node_modules,.git",sortOrder:"folders-first",collapseOnStartup:!1},w="folder-tree";var f=require("obsidian"),x=class extends f.PluginSettingTab{constructor(i,e){super(i,e),this.plugin=e}display(){let{containerEl:i}=this;i.empty(),new f.Setting(i).setName("Show hidden directories").setDesc("Include dot-prefixed directories (e.g., .github, .obsidian) in the tree. Hidden folders are shown by default.").addToggle(e=>e.setValue(this.plugin.settings.showHiddenDirs).onChange(async t=>{this.plugin.settings.showHiddenDirs=t,await this.plugin.saveSettings()})),new f.Setting(i).setName("File extensions").setDesc("Comma-separated list of extensions to include (e.g., .md,.mdx).").addText(e=>e.setPlaceholder(".md").setValue(this.plugin.settings.fileExtensions).onChange(async t=>{this.plugin.settings.fileExtensions=t,await this.plugin.saveSettings()})),new f.Setting(i).setName("Excluded directories").setDesc("Comma-separated directory names to always exclude.").addText(e=>e.setPlaceholder("node_modules,.git").setValue(this.plugin.settings.excludedDirs).onChange(async t=>{this.plugin.settings.excludedDirs=t,await this.plugin.saveSettings()})),new f.Setting(i).setName("Sort order").setDesc("How to sort files and directories in the tree.").addDropdown(e=>e.addOption("folders-first","Folders first").addOption("az","Alphabetical (A-Z)").addOption("za","Alphabetical (Z-A)").setValue(this.plugin.settings.sortOrder).onChange(async t=>{this.plugin.settings.sortOrder=t,await this.plugin.saveSettings()})),new f.Setting(i).setName("Collapse on startup").setDesc("Start with all directories collapsed when opening the view.").addToggle(e=>e.setValue(this.plugin.settings.collapseOnStartup).onChange(async t=>{this.plugin.settings.collapseOnStartup=t,await this.plugin.saveSettings()}))}};var p=require("obsidian");function F(a){return a.trim()?a.split(",").map(i=>i.trim()).filter(i=>i.length>0).map(i=>i.startsWith(".")?i:"."+i):[]}function I(a){return a.trim()?new Set(a.split(",").map(i=>i.trim()).filter(i=>i.length>0)):new Set}function P(a,i){if(a.type!=="file"){for(let e of a.children)P(e,i);switch(i){case"folders-first":a.children.sort((e,t)=>e.type!==t.type?e.type==="directory"?-1:1:e.name.localeCompare(t.name));break;case"az":a.children.sort((e,t)=>e.name.localeCompare(t.name));break;case"za":a.children.sort((e,t)=>t.name.localeCompare(e.name));break}}}function S(a,i){let e=F(i.fileExtensions),t=I(i.excludedDirs),s={name:"/",path:"",type:"directory",children:[]};if(e.length===0)return s;let n=new Map;n.set("",s);let d=a.vault.getFiles().filter(o=>e.some(r=>o.path.endsWith(r)));for(let o of d){let r=o.path.split("/"),h=r.pop(),l="",v=!1;for(let g of r){let N=l;if(l=l?l+"/"+g:g,t.has(g)){v=!0;break}if(!i.showHiddenDirs&&g.startsWith(".")){v=!0;break}if(!n.has(l)){let E={name:g,path:l,type:"directory",children:[]};n.set(l,E),n.get(N).children.push(E)}}if(!v){let N={name:h.replace(/\.[^.]+$/,""),path:o.path,type:"file",children:[]};n.get(l).children.push(N)}}return P(s,i.sortOrder),s}var b=class{constructor(i){this.document=i;this.menuEl=null;this.closeCallback=null;this.setupGlobalClickListener()}show(i,e,t){this.hide();let s=this.document.createElement("div");s.addClass("repo-nav-context-menu");for(let h of t){let l=s.createDiv({cls:"repo-nav-context-menu-item"});l.createSpan({cls:"repo-nav-context-menu-icon"}),(0,p.setIcon)(l,h.icon),l.createSpan({text:h.label}),l.addEventListener("click",v=>{v.stopPropagation(),h.action(),this.hide()})}this.document.body.appendChild(s);let n=150,d=t.length*36+8,o=i,r=e;o+n>this.document.body.clientWidth&&(o=this.document.body.clientWidth-n-8),r+d>this.document.body.clientHeight&&(r=this.document.body.clientHeight-d-8),s.style.left=`${o}px`,s.style.top=`${r}px`,this.menuEl=s}hide(){this.menuEl&&(this.menuEl.remove(),this.menuEl=null)}setupGlobalClickListener(){this.document.addEventListener("click",()=>{this.hide()})}},m=class extends p.ItemView{constructor(e,t){super(e);this.treeData=null;this.expandedPaths=new Set;this.debounceTimer=null;this.plugin=t,this.contextMenu=new b(this.containerEl.ownerDocument)}getViewType(){return u}getDisplayText(){return"Repository Navigator"}getIcon(){return w}async onOpen(){if(this.expandedPaths=new Set,this.treeData=S(this.app,this.plugin.settings),!this.plugin.settings.collapseOnStartup&&this.treeData)for(let e of this.treeData.children)e.type==="directory"&&this.expandedPaths.add(e.path);this.renderView(),this.registerEvent(this.app.vault.on("create",()=>this.debouncedRefresh())),this.registerEvent(this.app.vault.on("delete",()=>this.debouncedRefresh())),this.registerEvent(this.app.vault.on("rename",()=>this.debouncedRefresh())),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>this.updateActiveFile()))}async onClose(){this.debounceTimer!==null&&clearTimeout(this.debounceTimer)}expandAll(e){let t=this.findNode(this.treeData,e);if(t){let s=this.collectDescendantPaths(t);for(let n of s)this.expandedPaths.add(n);this.renderView()}}collapseAll(e){let t=this.findNode(this.treeData,e);if(t){let s=this.collectDescendantPaths(t);for(let n of s)this.expandedPaths.delete(n);this.renderView()}}findNode(e,t){if(!e)return null;if(e.path===t)return e;for(let s of e.children){let n=this.findNode(s,t);if(n)return n}return null}collectDescendantPaths(e){let t=[];if(e.type==="directory"){t.push(e.path);for(let s of e.children)t.push(...this.collectDescendantPaths(s))}return t}renderView(){this.contentEl.empty();let e=this.contentEl.createDiv({cls:"repo-nav-header"}),t=this.collectAllDirPaths(this.treeData),s=t.size>0&&t.size===this.expandedPaths.size,n=e.createEl("button",{attr:{"aria-label":s?"Collapse all":"Expand all"}});(0,p.setIcon)(n,s?"chevrons-down-up":"chevrons-up-down"),n.addEventListener("click",()=>{if(s)this.expandedPaths.clear();else for(let o of t)this.expandedPaths.add(o);this.renderView()});let c=e.createEl("button",{attr:{"aria-label":"Refresh"}});(0,p.setIcon)(c,"refresh-cw"),c.addEventListener("click",()=>{this.refreshTree()});let d=this.contentEl.createDiv({cls:"repo-nav-tree"});if(!this.treeData||this.treeData.children.length===0){d.createDiv({cls:"repo-nav-empty",text:"No Markdown files found in this vault."});return}for(let o of this.treeData.children)this.renderNode(d,o,0)}renderNode(e,t,s){let n=e.createDiv({cls:"repo-nav-node"});if(n.style.paddingLeft=`${s*16}px`,n.dataset.path=t.path,t.type==="directory"){n.addClass("repo-nav-dir");let c=this.expandedPaths.has(t.path),d=n.createSpan({cls:"repo-nav-chevron"});(0,p.setIcon)(d,c?"chevron-down":"chevron-right");let o=n.createSpan({cls:"repo-nav-icon"});if((0,p.setIcon)(o,"folder"),n.createSpan({cls:"repo-nav-name",text:t.name}),n.addEventListener("click",r=>{r.stopPropagation(),this.expandedPaths.has(t.path)?this.expandedPaths.delete(t.path):this.expandedPaths.add(t.path),this.renderView()}),n.addEventListener("contextmenu",r=>{r.preventDefault(),r.stopPropagation(),this.contextMenu.show(r.clientX,r.clientY,[{label:"Expand All",icon:"chevrons-up-down",action:()=>this.expandAll(t.path)},{label:"Collapse All",icon:"chevrons-down-up",action:()=>this.collapseAll(t.path)}])}),c){let r=e.createDiv({cls:"repo-nav-children"});for(let h of t.children)this.renderNode(r,h,s+1)}}else{n.addClass("repo-nav-file");let c=this.app.workspace.getActiveFile();c&&c.path===t.path&&n.addClass("repo-nav-active");let d=n.createSpan({cls:"repo-nav-icon"});(0,p.setIcon)(d,"file-text"),n.createSpan({cls:"repo-nav-name",text:t.name}),n.addEventListener("click",async o=>{o.stopPropagation();let r=this.app.vault.getAbstractFileByPath(t.path);r instanceof p.TFile&&(o.metaKey||o.ctrlKey?await this.app.workspace.getLeaf("tab").openFile(r):await this.app.workspace.getLeaf(!1).openFile(r))})}}collectAllDirPaths(e){let t=new Set;if(!e)return t;let s=n=>{n.type==="directory"&&n.path&&t.add(n.path);for(let c of n.children)s(c)};return s(e),t}debouncedRefresh(){this.debounceTimer!==null&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.refreshTree()},300)}updateActiveFile(){let e=this.app.workspace.getActiveFile();if(this.containerEl.querySelectorAll(".repo-nav-file").forEach(s=>s.removeClass("repo-nav-active")),e){let s=this.containerEl.querySelector(`.repo-nav-file[data-path="${CSS.escape(e.path)}"]`);s&&s.addClass("repo-nav-active")}}refreshTree(){this.treeData=S(this.app,this.plugin.settings),this.renderView()}};var y=class extends k.Plugin{constructor(){super(...arguments);this.settings=D}async onload(){await this.loadSettings(),this.registerView(u,e=>new m(e,this)),this.addRibbonIcon(w,"Repository Navigator",()=>{this.activateView()}),this.addCommand({id:"open-repo-nav",name:"Open tree view",callback:()=>{this.activateView()}}),this.addSettingTab(new x(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.activateView()})}onunload(){this.app.workspace.detachLeavesOfType(u)}async activateView(){let e=this.app.workspace.getLeavesOfType(u);if(e.length>0){this.app.workspace.revealLeaf(e[0]);return}let t=this.app.workspace.getLeftLeaf(!1);t&&(await t.setViewState({type:u,active:!0}),this.app.workspace.revealLeaf(t))}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},D,e),this.settings.showHiddenDirs===!1&&(this.settings.showHiddenDirs=!0,await this.saveData(this.settings))}async saveSettings(){await this.saveData(this.settings);let e=this.app.workspace.getLeavesOfType(u);for(let t of e){let s=t.view;s instanceof m&&s.refreshTree()}}};
